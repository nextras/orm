services:
  mysql:
    image: mysql:${MYSQL_VERSION:-latest}
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: nextras_orm_test
    tmpfs:
      - /var/lib/mysql
    command: >
      --innodb-flush-log-at-trx-commit=0
      --innodb-doublewrite=0
      --skip-log-bin
  pgsql:
    image: postgres:${PGSQL_VERSION:-17}
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: nextras_orm_test
    tmpfs:
      - /var/lib/postgresql/data
    command: >
      -c fsync=off
      -c synchronous_commit=off
      -c full_page_writes=off
  sqlsrv:
    image: mcr.microsoft.com/mssql/server:${MSSQL_VERSION:-2025-latest}
    environment:
      ACCEPT_EULA: "Y"
      MSSQL_SA_PASSWORD: ${MSSQL_SA_PASSWORD:-YourStrong!Passw0rd}
      MSSQL_PID: "Developer"
    tmpfs:
      - /var/opt/mssql:rw,uid=10001,gid=0,mode=0775,size=1g
    healthcheck:
      test: ["CMD-SHELL", "pidof sqlservr >/dev/null || exit 1"]
      interval: 5s
      timeout: 3s
      retries: 30
  php:
    build:
      context: .docker/php
      dockerfile: Dockerfile
    volumes:
      - .:/app
